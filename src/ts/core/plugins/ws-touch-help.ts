import {WebSlidesPlugin} from '../web-slides-plugin';
import {DeviceDetector} from '../utils/devices';
import {SlideEventType} from '../web-slide-event';

export class WebSlidesTouchHelpPlugin extends WebSlidesPlugin {

    static SHOW_TIMEOUT = 4000;
    static CLEAR_TIME = 5000;

    private helperTimeout: number;

    bind(): void {
        if (DeviceDetector.isTouchDevice()) {
            this.ws.addEventListener(SlideEventType.CHANGED, this.deactivate, {
                once: true
            });
            this.helperTimeout = setTimeout(this.show, WebSlidesTouchHelpPlugin.SHOW_TIMEOUT);
        }
    }
    destroy(): void {
        this.ws.removeEventListener(SlideEventType.CHANGED, this.deactivate);
    }

    show = () => {
        const helperBlock = document.createElement('div');
        helperBlock.classList.add('ws-touch-help');

        /* tslint:disable:max-line-length */
        helperBlock.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8480 9800">
                <path class="arrow" d="M5044 9786c-45-20-107-79-142-134-17-26-46-93-66-149-76-221-69-215-431-356-327-128-697-303-915-433-225-134-465-344-703-614-60-69-211-249-335-400-326-398-460-547-807-900-468-475-502-519-546-687-40-157-20-330 56-488 90-187 245-321 445-386 93-30 278-37 391-15 210 43 438 166 716 389 199 159 213 170 208 155-2-7-45-141-96-298-50-157-250-776-444-1375-612-1891-676-2102-704-2321-6-48-7-105-1-141 32-227 234-460 477-549 72-27 88-29 213-29 126 1 142 3 230 34 132 45 193 82 286 175 126 126 164 215 404 961 137 424 229 696 240 708 4 5 31-24 61-64 65-89 174-176 283-229 103-50 219-65 386-50 179 15 263 52 406 177l77 67 19-25c45-57 146-153 198-187 121-80 251-116 415-116 258 1 434 94 611 320l65 83 96-84c167-147 325-202 553-192 245 10 424 113 557 320 58 89 84 147 182 409 45 119 194 499 332 845 512 1282 621 1606 684 2043 27 188 39 602 26 888-11 262-26 384-84 712l-33 184 59 206c73 258 79 307 44 384-33 73-73 123-111 143-29 15-531 192-661 232-33 11-217 71-410 134-747 246-1529 495-1903 606-212 63-271 72-328 47zm638-595c671-216 1185-382 1764-573l551-181-13-66c-7-36-22-109-34-161-31-137-29-235 14-480 20-113 42-263 51-333 22-189 29-523 16-757-31-571-116-858-659-2225-257-648-310-784-387-998-79-218-125-287-217-328-68-29-184-32-240-5-50 24-143 125-158 172-19 56-6 172 35 314 48 170 52 211 26 282-62 163-275 248-408 162-77-50-132-161-248-494-128-372-165-460-210-506-106-106-300-98-414 16-68 67-85 118-78 223 3 45 16 118 30 162 13 44 47 156 76 249 85 277 81 356-23 454-65 61-107 75-213 71-101-5-143-30-194-118-41-70-70-144-200-521-139-403-185-485-293-514-101-28-152-30-201-6-47 23-135 111-162 164-36 69-16 160 177 771 164 520 170 558 115 671-75 153-214 208-387 154-89-27-144-69-174-133-22-47-177-513-688-2067-195-592-289-859-340-966-31-67-38-73-90-98-76-36-170-45-231-22-84 32-171 160-169 246 2 71 180 644 734 2360 453 1406 658 2054 715 2264 33 121 27 153-42 227-81 87-227 134-299 96-44-23-137-109-489-450-176-170-367-348-425-394-267-214-535-262-693-124-48 43-88 126-94 198-5 55-3 61 38 122 23 35 171 195 328 355 432 440 594 620 950 1059 265 326 416 498 519 590 282 254 648 460 1211 682 312 123 409 167 460 210 55 47 121 142 168 243 44 94 68 132 84 132 4 0 189-58 411-129z"/>
                <path class="hand" d="M392 4844c-31-21-53-69-101-218-116-355-191-766-222-1200-17-249-6-863 20-1126 54-537 138-1023 287-1644 35-148 64-271 64-273 0-11-28 4-109 57C109 586 16 597 3 479c-5-41-2-50 27-83 52-59 326-254 485-345 115-66 143-67 199-8 79 82 311 436 357 544 25 59 25 107-2 131-25 24-71 34-102 23-33-13-95-84-167-192-72-107-98-139-116-139-21 0-82 230-178 675-126 586-188 1016-217 1510-13 220-7 750 11 925 40 398 80 608 205 1070 15 52 29 125 32 161 5 59 3 69-16 88-26 26-95 29-129 5z"/>
            </svg>
        `;
        /* tslint:enable:max-line-length */

        this.ws.appendChild(helperBlock);
        setTimeout(() => this.ws.removeChild(helperBlock), WebSlidesTouchHelpPlugin.CLEAR_TIME);
    };
    deactivate = () => this.helperTimeout && clearTimeout(this.helperTimeout);
}